<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssm.qs.dao.UserDao">
    <!--1.手机查用户是否存在，密码登录，根据id返回信息-->
    <resultMap id="userMap" type="User">
        <id property="id" column="ID"></id>
        <result property="nickName" column="NICK_NAME"></result>
        <result property="realName" column="REAL_NAME"></result>
        <result property="gender" column="GENDER"></result>
        <result property="phone" column="PHONE"></result>
        <result property="nation" column="NATION"></result>
        <result property="city" column="CITY"></result>
        <result property="profession" column="PROFESSION"></result>
        <result property="introduce" column="INTRODUCE"></result>
    </resultMap>
    <select id="getUser" parameterType="User" resultMap="userMap">
        SELECT ID,NICK_NAME,REAL_NAME,GENDER,PHONE,NATION,CITY,PROFESSION,INTRODUCE
        FROM USER
        <where>
            <if test="phone!=null and phone!=''">PHONE=#{phone}</if>
            <if test="id!=null"> AND ID=#{id}</if>
            <if test="userName!=null and userName!=''">AND USER_NAME=#{userName}</if>
            <if test="email!=null and email!=''"> AND EMAIL=#{email}</if>
            <if test="password!=null and password!=''"> AND PASSWORD=#{password}</if>
        </where>
    </select>
    <!--2.新建用户:插入必填项，其他的后面更新-->
    <insert id="addUser" parameterType="User" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO USER(USER_NAME,NICK_NAME,REAL_NAME,PHONE) VALUES(#{userName},#{nickName},#{realName},#{phone})
    </insert>
    <!--3.插入登录票据-->
    <insert id="addTicket" parameterType="Info" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO INFO(TICKET,UID)
        VALUES (#{ticket},#{uid})
    </insert>
    <!--4.查票据id-->
    <select id="getUID" parameterType="String" resultType="int">
        SELECT UID FROM INFO WHERE TICKET=#{ticket}
    </select>
    <!--5.更新密码，更新用户信息-->
    <update id="updateUser" parameterType="User">
        UPDATE USER
        <set>
            <if test="password!=null and password!=''">PASSWORD=#{password}</if>
            <if test="nickName!=null and nickName!=''">NICK_NAME=#{nickName}</if>/*昵称*/
            <if test="realName!=null and realName!=''">REAL_NAME=#{realName}</if>/*真名*/
            <if test="gender!=null and gender!=''">GENDER=#{gender}</if>/*性别*/
            <if test="age!=null">AGE=#{age}</if>/*年龄*/
            <if test="nation!=null and nation!=''">NATION=#{nation}</if>/*民族*/
            <if test="city!=null and city!=''">CITY=#{city}</if>/*常住城市*/
            <if test="profession!=null and profession!=''">PROFESSION=#{profession}</if>/*职业*/
            <if test="introduce!=null and introduce!=''">INTRODUCE=#{introduce}</if>/*简介*/
        </set>
        WHERE ID=#{id}
    </update>
    <!--6.退出登录-->
    <delete id="deleteTicket" parameterType="String">
        DELETE FROM INFO WHERE TICKET=#{ticket}
    </delete>
</mapper>