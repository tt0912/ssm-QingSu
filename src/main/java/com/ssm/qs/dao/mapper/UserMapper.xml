<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssm.qs.dao.UserDao">
    <!--1.手机登录查用户-->
    <select id="getUser" parameterType="User" resultType="User">
        SELECT ID,USER_NAME,NICK_NAME,REAL_NAME,GENDER,EMAIL,PHONE,NATION,CITY,PROFESSION,INTRODUCE
        FROM USER
        <where>
            <if test="phone!=null and phone phone!=''"> PHONE=#{phone}</if>
            <if test="id!=null"> AND ID=#{id}</if>
            <if test="username!=null and username!=''"> AND USER_NAME=#{userName}</if>
            <if test="email!=null and email!=''"> AND EMAIL=#{email}</if>
            <if test="password!=null and password!=''"> AND PASSWORD=#{password}</if>
        </where>
    </select>
    <!--2.新建用户:插入必填项，其他的后面更新-->
    <insert id="addUser" parameterType="User" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO USER(USER_NAME,NICK_NAME,REAL_NAME,PHONE) VALUES(#{userName},#{nickName},#{realName},#{phone})
    </insert>
    <!--3.插入登录票据-->
    <insert id="addTicket" parameterType="Info" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO INFO(TICKET,UID)
        VALUES (#{ticket},#{id})
    </insert>
    <!--4.查票据-->
    <select id="getTicket" parameterType="String" resultType="int">
        SELECT UID FROM INFO WHERE TICKET=#{ticket}
    </select>
    <!--5.更新密码-->
    <update id="updateUser" parameterType="User">
        UPDATE USER SET PASSWORD=#{password}
        WHERE ID=#{id}
    </update>
    <!--6.退出登录-->
    <delete id="deleteTicket" parameterType="String">
        DELETE FROM INFO WHERE TICKET=#{ticket}
    </delete>
</mapper>